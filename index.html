<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Prompts Galerie</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root {
    --img-height: 240px;
    --selected-border-color: orange;
    --selected-border-width: 3px;
}
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #2b2b2b;
    color: #e0e0e0;
    overflow: hidden;
}
.header {
    padding: 15px 20px 10px;
    border-bottom: 1px solid #444;
}
.controls {
    display: flex;
    gap: 10px;
}
.main {
    display: flex;
    height: calc(100vh - 80px);
}
.gallery {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 15px;
    overflow-y: auto;
}
.gallery img {
    height: var(--img-height);
    cursor: pointer;
}
.gallery img.selected {
    border: var(--selected-border-width) solid var(--selected-border-color);
}
.prompt-panel {
    width: 480px;
    border-left: 1px solid #444;
    padding: 10px;
    overflow-y: auto;
}
</style>
</head>

<body>

<div class="header">
    <h2>Prompts Galerie</h2>
    <div class="controls">
        <input type="file" id="folderInput" webkitdirectory multiple>
        <button id="exportZip">Exporter le site</button>
    </div>
</div>

<div class="main">
    <div class="gallery" id="gallery"></div>
    <div class="prompt-panel" id="promptContent">
        SÃ©lectionne un dossier pour charger la galerie.
    </div>
</div>

<script>
const gallery = document.getElementById("gallery");
const folderInput = document.getElementById("folderInput");
const promptContent = document.getElementById("promptContent");
const exportZipBtn = document.getElementById("exportZip");

let selectedImage = null;
let localTexts = {};

function selectImage(img, base, txtFile) {
    if (selectedImage) selectedImage.classList.remove("selected");
    selectedImage = img;
    img.classList.add("selected");

    txtFile.text().then(text => {
        promptContent.textContent = text;
        navigator.clipboard.writeText(text);
    });
}

/* MODE LOCAL UNIQUEMENT */
folderInput.onchange = () => {
    gallery.innerHTML = "";
    promptContent.textContent = "Clique sur une image.";

    const images = [];
    localTexts = {};

    [...folderInput.files].forEach(f => {
        if (f.type.startsWith("image/")) images.push(f);
        if (f.name.endsWith(".txt")) {
            localTexts[f.name.replace(".txt","")] = f;
        }
    });

    images.forEach(f => {
        const img = document.createElement("img");
        img.src = URL.createObjectURL(f);
        const base = f.name.replace(/\.(png|jpg|jpeg)$/i,"");
        img.onclick = () => selectImage(img, base, localTexts[base]);
        gallery.appendChild(img);
    });
};

/* EXPORT */
exportZipBtn.onclick = async () => {
    const zip = new JSZip();
    zip.file("index.html", "<!DOCTYPE html>\n" + document.documentElement.outerHTML);
    const blob = await zip.generateAsync({ type: "blob" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "site-galerie.zip";
    a.click();
};
</script>

</body>
</html>
